#!/usr/bin/env bash
# Bash script that configures an Ubuntu server and:
#+ resolves localhost to 127.0.0.2
#+ resolves facebok to 8.8.8.8

# create and poulate array of hosts and set variables.
declare -A hosts_arr
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
hosts_arr["facebook.com"]="8.8.8.8"
hosts_arr["localhost"]="127.0.0.2"
hosts_file="/etc/hosts"
<<<<<<< HEAD
<<<<<<< HEAD
=======
hosts_arr["facebook"]="8.8.8.8"
=======
hosts_arr["facebook.com"]="8.8.8.8"
>>>>>>> b19bebc... fix(a_devops:0x08): change facebook hostname
hosts_arr["localhost"]="127.0.0.2"
>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
=======
>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz
=======
hosts_arr["facebook"]="8.8.8.8"
=======
hosts_arr["facebook.com"]="8.8.8.8"
>>>>>>> b19bebc... fix(a_devops:0x08): change facebook hostname
hosts_arr["localhost"]="127.0.0.2"
>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
=======
>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz
vfile="./hosts.temp"
vhosts_bak="/etc/hosts.bak"

# backup hosts file and copy to current location
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
if [[ -f "$hosts_file" ]]; then
    cp "$hosts_file" "$vfile"

    # avoid existing *.bak host file overwrite
=======
if [[ -f "$hosts_file" ]]; then
    cp "$hosts_file" "$vfile"

<<<<<<< HEAD
>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz
=======
    # avoid existing *.bak host file overwrite
>>>>>>> 18dcc25... style(a_devops:0x08): rm unused spaces and add comments
=======
if [[ -f "$hosts_file" ]]; then
    cp "$hosts_file" "$vfile"

>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz
    while [[ -f "$vhosts_bak" ]]; do
	vhosts_bak+=".bak"
    done

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
    # mv /etc/hosts "$vhosts_bak"
=======
    #mv /etc/hosts "$vhosts_bak"
>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz
=======
    # mv /etc/hosts "$vhosts_bak"
>>>>>>> 18dcc25... style(a_devops:0x08): rm unused spaces and add comments
=======
    #mv /etc/hosts "$vhosts_bak"
>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz
    mv "$hosts_file" "$vhosts_bak"
else
    touch "$vfile"
fi
<<<<<<< HEAD
<<<<<<< HEAD
=======
=======
>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
cp /etc/hosts "$vfile"
while [[ -f "$vhosts_bak" ]]; do
    vhosts_bak+=".bak"
done

#cp /etc/hosts "$vhosts_bak"
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
sudo mv /etc/hosts "$vhosts_bak"
>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
=======
mv /etc/hosts "$vhosts_bak"
>>>>>>> 08368be... style(a_devops:0x08): remove sudo cmd
=======

<<<<<<< HEAD

>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz

=======
>>>>>>> 18dcc25... style(a_devops:0x08): rm unused spaces and add comments
=======
sudo mv /etc/hosts "$vhosts_bak"
=======
mv /etc/hosts "$vhosts_bak"
>>>>>>> 08368be... style(a_devops:0x08): remove sudo cmd
=======


>>>>>>> 89a9d00... fix(a_devops:0x08): change codeflow of file 0_xyz

>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
# edit host file(copy) as required
for host in "${!hosts_arr[@]}"; do
    host_line="$(sed -En "/$host$/p" $vfile)"
    new_host_line="$(echo -e ${hosts_arr[$host]}$'\t'$host)"
    if (( "${#host_line}" )); then
	sed -Ei "s/$host_line/$new_host_line/" "$vfile"
    else
	echo "$new_host_line" >> "$vfile"
    fi
done

# place hosts file back to the /hosts dir
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
cp -f "$vfile" /etc/hosts
rm "$vfile"
=======
sudo mv "$vfile" /etc/hosts
>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
=======
sudo mv -f "$vfile" /etc/hosts
>>>>>>> 1807f53... fix(a_devops:0x08): force final mv cmd
=======
mv -f "$vfile" /etc/hosts
>>>>>>> 08368be... style(a_devops:0x08): remove sudo cmd
=======
cp -f "$vfile" /etc/hosts
rm "$vfile"
>>>>>>> 9cd87ca... refactor(a_devops:0x08): change last mv cmd
=======
sudo mv "$vfile" /etc/hosts
>>>>>>> 111ceef... feat(a_devops): add task_0 solution file
=======
sudo mv -f "$vfile" /etc/hosts
>>>>>>> 1807f53... fix(a_devops:0x08): force final mv cmd
=======
mv -f "$vfile" /etc/hosts
>>>>>>> 08368be... style(a_devops:0x08): remove sudo cmd
=======
cp -f "$vfile" /etc/hosts
rm "$vfile"
>>>>>>> 9cd87ca... refactor(a_devops:0x08): change last mv cmd
